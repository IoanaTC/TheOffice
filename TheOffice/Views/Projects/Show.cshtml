@model TheOffice.Models.Project
@using Task = TheOffice.Models.Task

<!DOCTYPE>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="~/css/ProjectsShow.css" asp-append-version="true" />

    <script>
        
            function allowDrop(event){
                event.preventDefault();
            }

            function drag(event){
                event.dataTransfer.setData("div", event.target.id);
            }

            function drop(event){
                event.preventDefault();
                var data = event.dataTransfer.getData("div");
                event.target.appendChild(document.getElementById(data));

                $.ajax({
                url: '@Url.Action( "AssignTask", "Projects")',
                    data: { itemId: data.id,
                            parentId: event.target.id},
                    type: 'POST'
                    
                }); 
            }
       
    </script>
</head>
<body>
    @if (ViewBag.Message != null)
    {
        <h2 class="alert-success">@ViewBag.Message</h2>
    }
    @if (ViewBag.Message_task != null)
    {
        <h2 class="alert-success">@ViewBag.Message_task</h2>
    }
    <br />
    <div class="justify-content-center">
        <div id="container-header" class="d inline-flex justify-content-center">
            <div id="container-title"></div>
                <h2 id="title">@Model.Title</h2><br />
                <h4 id="content">@Model.Description</h4>
            </div>

            <img id="photo" src="@Model.Photo" />
        </div>
    
    <br />
    <h3 id="members">Membrii echipei</h3><br />
    

    <div class="d-inline-flex justify-content-center">

        @foreach (ApplicationUser member in ViewBag.Members)
        {
            <div class="member" id="@member.Email" ondrop="drop(event)" ondragover="allowDrop(event)" class="card m-4" style="width: 18rem;">

                <h4>@member.Email</h4>

                <div class="d-block">
                    @foreach (Task task in member.Tasks)
                    {
                        <partial name="TaskCard" model="task"></partial>
                    }
                    <br />
                </div>

           </div>
        }
        <div id="0" ondrop="drop(event)" ondragover="allowDrop(event)" class="card m-4" style="width: 18rem;">

            <div class="d-block">
                @foreach (Task task in ViewBag.Tasks)
                {
                    <partial name="TaskCard" model="task"></partial>
                }
                <br />
            </div>
        </div>

    </div>
    <br />

    <br />
    @if (ViewBag.isAdmin == true || ViewBag.isOrganizator == true)
    {
        <a href="/Projects/Edit/@Model.Id" class="btn btn-outline-warning m-2">Edit</a>
        <a href="/Projects/Delete/@Model.Id" class="btn btn-outline-danger m-2">Delete</a>
        <a href="/Tasks/New?project=@Model.Id" class="btn btn-outline-primary m-2">Add Tasks</a>
        <a href="/Projects/EditMembers/@Model.Id" class="btn btn-outline-warning m-2">Edit Members</a>
    }
    </div>
</body>
</html>